## Основные термины и понятия Docker

* `Docker host` — это операционная система, на которую устанавливают Docker и на которой он работает.
* `Docker daemon` — служба, которая управляет Docker-объектами: сетями, хранилищами, образами и контейнерами.
* `Docker client` — консольный клиент, при помощи которого пользователи взаимодействуют с Docker daemon и отправляют ему
  команды, создают контейнеры и управляют ими.
* `Docker image` — это неизменяемый образ, из которого разворачивается контейнер.
* `Docker container` — развёрнутое и запущенное приложение.
* `Docker Registry` — репозиторий, в котором хранятся образы.
* `Dockerfile` — файл-инструкция для сборки образа.
* `Docker Compose` — инструмент для управления несколькими контейнерами. Он позволяет создавать контейнеры и задавать их
  конфигурацию.
* `Docker Desktop` — GUI-клиент, который распространяется по GPL. Это очень удобный клиент, который отображает все
  сущности Docker и позволяет запустить однонодовый Kubernetes для компьютера.

> Docker изначально создавался под Linux. Поэтому на Windows и macOS запускают виртуальную машину с Linux, а поверх
> неё — Docker. В macOS используют VirtualBox, а в Windows — Hyper-V.
> Работа поверх виртуалок повышает потребление ресурсов. Поэтому Docker на macOS и Windows работает медленнее и с рядом
> ограничений. Для разработки это приемлемо, но «в бою» так делать никто не будет. На всех популярных платформах в проде
> используют Linux.

---

## Чем отличается виртуализация от контейнеризации?

Контейнеры и виртуальные машины — это разные способы виртуализации. Только виртуалка реализует её на уровне железа, а
Docker — на уровне операционной системы.

Виртуальная машина функционирует как отдельный компьютер с собственным оборудованием и операционной системой. Сервер
«нарезается» на много виртуальных компьютеров, что избавляет нас от необходимости покупать их отдельно. Виртуальные
компьютеры вполне полноценны. На них можно установить операционную систему любого семейства и работать в ней, например,
через графический интерфейс в многопользовательском режиме, устанавливая и запуская множество приложений и сервисов.

Основная цель Docker — создать среду для одного приложения. Виртуальная среда контейнера запускается внутри операционной
системы. Ей не нужно виртуализировать оборудование — она использует его через ОС. Поэтому контейнеры Docker потребляют
меньше ресурсов, быстрее развёртываются, проще масштабируются и меньше весят.

Оба способа изолируют приложение от основной операционной системы, но если на виртуалку можно поставить любую ОС, то
Docker ориентирован на ядро Linux.

---

## Сущности Docker

`Docker image (образ)`. Это шаблон, по которому создают контейнеры. Его часто сравнивают со слоёным пирогом: мы
накладываем слой файловой системы поверх слоя базового образа и получаем неизменяемый образ. В него можно установить
приложение, конфигурации и зависимости. Другие образы могут наследоваться, поэтому если положить сверху слой файлов и
закоммитить, то мы получим ещё один неизменяемый образ.

`Dockerfile`. Если Docker image — это пирог, то Dockerfile — рецепт его приготовления. В этом файле описаны основные
инструкции для сборки образа: какой базовый образ взять, откуда и куда положить файлы и так далее.

`Контейнер` — это runtime-сущность на основе образа, приложение, которое мы развернули с помощью Docker. Можно провести
такую аналогию: образ — это инсталлятор программы, а контейнер — уже запущенная программа.

`Docker Registry`. Это репозиторий, в котором хранятся Docker-образы. Он может быть как локальным, так и публичным.
Репозитории создают на платформах вроде Docker Hub и GitLab и размещают в них образы с описанием, разными версиями и
тегами.

---

## Основные команды

`docker run image_id` - запускаем создание контейнера из образа.

`docker build .` - создаем образ из Dockerfile, который лежит в корневой папке.

`docker start container_id` - стартуем докер контейнер.

`docker stop container_id` - останавливаем докер контейнер.

`docker run -p 3000:8080 image_id` - создаем контейнер, указывая внешний порт (3000) и внутренний (8080).

`docker run -d image_id` - создаем контейнер, -d (detach) указывает, что не нужно переходить в консоль контейнера.

`docker images` - просмотр всех образов.

`docker ps` - просмотр всех работающих контейнеров.

`docker ps -a` - просмотр всех контейнеров.

`docker container prune` - удаление неактивных контейнеров.

`docker image ls` - альтернативный способ просмотра всех образов.

`docker attach container_id` - подключение к существующему контейнеру.

`docker logs container_id` - просмотр логов контейнера.

`docker rm container_id` - удаление контейнера.

`docker rmi image_id` - удаление образа.

`docker build -t image_name .` - создание образа из Dockerfile, лежащего в текущей папке. `-t image_name` отвечает за
создание имени образа в репозитории.

`docker build -t image_name:version .` - здесь version - версия образа.

---

## Структура Dockerfile

```dockerfile
FROM eclipse-temurin:17-alpine 
WORKDIR /app
COPY . .
RUN
CMD ["java", "-jar", "app-snapshot.jar"]
EXPOSE 8080
```

`FROM eclipse-temurin:17-alpine ` - отсюда берем jdk.

`WORKDIR /app` - место, куда будет помещен jar-файл в контейнере.

`COPY . .` - копируем откуда (локально) куда

`RUN` - здесь указываем то, что должно быть прописано в консоли при сборке образа.

`CMD ["java", "-jar", "app-snapshot.jar"]` - то, что будет писаться в консоль при каждом запуске контейнера.

`EXPOSE 8080` - указываем внутренний порт контейнера.

---